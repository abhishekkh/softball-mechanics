---
phase: 02-ai-pose-analysis
plan: 06
type: execute
wave: 4
depends_on: [02-05]
files_modified: []
autonomous: false

requirements: [AI-01, AI-02, AI-03]

must_haves:
  truths:
    - "Coach can see a pose skeleton overlay on a video frame in the review workspace"
    - "Joint angles (hip rotation, elbow slot, shoulder tilt) display in the sidebar and update as video scrubs"
    - "Video timeline shows color-coded markers at flagged frame positions"
    - "Sidebar shows issue label and confidence % when coach is on a flagged frame"
    - "Skeleton toggle button hides and shows the overlay"
    - "Analysis progress indicator shows while analysis is running"
  artifacts:
    - path: "src/app/(app)/review/[videoId]/page.tsx"
      provides: "Review workspace accessible at /review/[videoId]"
    - path: "src/components/review/VideoWithOverlay.tsx"
      provides: "Skeleton canvas overlay on video"
    - path: "src/components/review/MechanicsSidebar.tsx"
      provides: "Live joint angles + flags sidebar"
    - path: "src/components/review/AnalysisTimeline.tsx"
      provides: "Flagged frame markers on scrubber"
  key_links:
    - from: "Coach browser"
      to: "/review/[videoId]"
      via: "Direct URL or dashboard link"
      pattern: "review.*videoId"
---

<objective>
End-to-end verification of the complete Phase 2 AI Pose Analysis feature: skeleton overlay, joint angles, mechanics flagging, and analysis pipeline.

Purpose: Confirms that all automated Phase 2 work functions correctly in the running application from a coach's perspective. This is the final gate before Phase 2 is marked complete.
Output: Human verification of all three Phase 2 success criteria (AI-01, AI-02, AI-03).
</objective>

<execution_context>
@/Users/abhishekhodavdekar/.claude/get-shit-done/workflows/execute-plan.md
@/Users/abhishekhodavdekar/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/02-ai-pose-analysis/02-CONTEXT.md
@.planning/phases/02-ai-pose-analysis/02-05-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>End-to-end Phase 2 verification: skeleton overlay, joint angles, mechanics flagging</name>
  <action>Human verification — no automated implementation in this task. All code was built in Plans 01–05.</action>
  <verify>See how-to-verify instructions below</verify>
  <done>Coach confirms skeleton overlay renders, joint angles update on scrub, flagged frame markers visible</done>
  <what-built>
    Complete Phase 2 AI Pose Analysis feature:
    - Supabase video_analyses + video_analysis_frames tables with RLS
    - Inngest transcode-video Step 6: auto-creates pending analysis row after transcoding
    - MediaPipe PoseLandmarker running in Web Worker at 5fps sampling
    - POST /api/analysis route persisting frame data to Supabase
    - /review/[videoId] workspace with skeleton overlay, joint angles sidebar, flagged frame timeline
  </what-built>
  <how-to-verify>
    **Pre-flight:** Ensure Supabase migration 005 has been applied (either via `npx supabase db push` or the Dashboard SQL editor).

    **Run:** `npm run dev`

    **Flow 1: Analysis pipeline (AI-01, AI-03)**
    1. Log in as a coach
    2. Upload a new video (or use an already-transcoded video from Phase 1 testing)
    3. Navigate to /review/[videoId] (replace videoId with the actual UUID from the video)
    4. EXPECTED: You see the video player and a sidebar with "Analyzing… X%" progress
    5. EXPECTED: After analysis completes (~15-60 seconds for a typical clip), the progress bar disappears
    6. EXPECTED: If you uploaded video of a person (any video with a visible body), a skeleton is drawn on the video

    **Flow 2: Skeleton overlay toggle (AI-01)**
    7. While skeleton is visible, click the "Skeleton Overlay" toggle in the sidebar
    8. EXPECTED: Skeleton disappears — clean video without overlay
    9. Click toggle again — EXPECTED: skeleton reappears

    **Flow 3: Joint angles (AI-02)**
    10. Scrub the video to different positions (drag the playhead)
    11. EXPECTED: Hip Rotation, Elbow Slot, Shoulder Tilt values update in the sidebar with each position change
    12. Values in range should appear in green; out-of-range values in amber

    **Flow 4: Mechanics flagging (AI-03)**
    13. If any flagged frames exist, you will see colored markers on the timeline strip below the video
    14. EXPECTED: Red markers = error-severity flags, yellow markers = warning-severity flags
    15. Click a timeline marker — EXPECTED: video seeks to that frame; sidebar shows the issue label and confidence %
    16. Click "Next Flag" and "Prev Flag" buttons — EXPECTED: video seeks between flagged frames

    **Flow 5: Re-analyze (regression)**
    17. Click "Re-analyze" button
    18. EXPECTED: Progress bar reappears, analysis runs again
    19. EXPECTED: After completion, results are visible again

    **Acceptable partial pass:** If the uploaded test video has no visible human body (landscape, objects only), the skeleton may not appear — this is correct behavior. To fully test AI-01, use a video of a person walking or swinging.
  </how-to-verify>
  <resume-signal>
    Type "approved" if Flows 1–4 all pass (Flow 5 optional).
    Or describe specific issues: which flow failed, what you saw vs. expected.
  </resume-signal>
</task>

</tasks>

<verification>
All three Phase 2 success criteria from ROADMAP.md verified by coach:
1. AI-01: Pose skeleton overlay visible on video frames with toggle working
2. AI-02: Joint angles (hip rotation, elbow slot, shoulder tilt) display and update live
3. AI-03: Flagged frames shown on timeline with issue labels and confidence scores
</verification>

<success_criteria>
Phase 2 is complete when:
1. Coach confirms skeleton overlay renders on video frames
2. Coach confirms joint angles update as video scrubs
3. Coach confirms flagged frame markers visible on timeline with sidebar issue display
</success_criteria>

<output>
After completion, create `.planning/phases/02-ai-pose-analysis/02-06-SUMMARY.md`
</output>
