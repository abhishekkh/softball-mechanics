---
phase: 01-foundation
plan: 05
type: execute
wave: 4
depends_on:
  - 01-03
  - 01-04
files_modified:
  - src/app/(app)/layout.tsx
  - src/app/(app)/dashboard/page.tsx
  - src/app/(app)/submissions/page.tsx
  - src/app/(app)/upload/page.tsx
  - src/components/roster/RosterList.tsx
  - src/components/roster/InviteAthleteModal.tsx
  - src/components/dashboard/SessionRow.tsx
autonomous: false
requirements:
  - ROST-01
  - ROST-02

must_haves:
  truths:
    - "Coach sees their session queue at /dashboard — list of uploaded videos sorted by most recent, each row showing thumbnail, athlete name + avatar, upload date, and status badge"
    - "Athlete sees only their own submissions at /submissions — videos uploaded by them or for them"
    - "Coach can open an invite modal, enter an athlete's email, and the athlete receives an invite email"
    - "Coach can view their full athlete roster with each athlete's name, status (pending/active), and video count"
    - "Middleware enforces role-scoped views — coaches cannot see /submissions, athletes cannot see /dashboard"
    - "New coach with no athletes sees a helpful empty state with a call to invite their first athlete"
  artifacts:
    - path: "src/app/(app)/layout.tsx"
      provides: "Authenticated app layout with nav and role-based routing"
      contains: "role"
    - path: "src/app/(app)/dashboard/page.tsx"
      provides: "Coach session queue — server component fetches videos for all coach's athletes"
      contains: "SessionRow"
    - path: "src/app/(app)/submissions/page.tsx"
      provides: "Athlete submissions view — server component fetches only the athlete's own videos"
      contains: "athlete_id"
    - path: "src/app/(app)/upload/page.tsx"
      provides: "Upload page with VideoUploader wired to the athlete assignment dropdown"
      contains: "VideoUploader"
    - path: "src/components/roster/RosterList.tsx"
      provides: "Athlete roster list component"
      contains: "coach_athletes"
    - path: "src/components/roster/InviteAthleteModal.tsx"
      provides: "Modal to invite a new athlete by email"
      contains: "inviteAthlete"
    - path: "src/components/dashboard/SessionRow.tsx"
      provides: "Single row in coach session queue showing thumbnail, athlete, date, status"
      contains: "TranscodingStatus"
  key_links:
    - from: "src/app/(app)/dashboard/page.tsx"
      to: "Supabase videos + profiles tables"
      via: "Server component query: videos joined with profiles where coach_id = user.id, ordered by uploaded_at desc"
      pattern: "from.*videos.*select|coach_id.*auth"
    - from: "src/app/(app)/submissions/page.tsx"
      to: "Supabase videos table"
      via: "Server component query: videos where athlete_id = user.id, ordered by uploaded_at desc"
      pattern: "from.*videos.*athlete_id"
    - from: "src/components/roster/InviteAthleteModal.tsx"
      to: "src/actions/auth.ts inviteAthlete"
      via: "form action calling inviteAthlete server action with email + coachId"
      pattern: "inviteAthlete"
    - from: "src/app/(app)/layout.tsx"
      to: "src/middleware.ts"
      via: "x-user-role header set by middleware, read in layout to render role-appropriate nav"
      pattern: "x-user-role|headers"
---

<objective>
Build the coach dashboard (session queue), athlete submissions view, roster management UI, and invite athlete flow. Wire the upload page with athlete assignment. Add a human verification checkpoint to confirm the complete Phase 1 flow works end-to-end.

Purpose: This plan closes Phase 1 — every feature from login to upload to roster is wired together. The checkpoint ensures the full user journey works before Phase 2 begins.
Output: Coach dashboard, athlete view, roster management, upload page with athlete selector, and end-to-end verification.
</objective>

<execution_context>
@/Users/abhishekhodavdekar/.claude/get-shit-done/workflows/execute-plan.md
@/Users/abhishekhodavdekar/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
@.planning/phases/01-foundation/01-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: App layout, coach dashboard, and athlete submissions view</name>
  <files>
    src/app/(app)/layout.tsx
    src/app/(app)/dashboard/page.tsx
    src/app/(app)/submissions/page.tsx
    src/app/(app)/upload/page.tsx
    src/components/dashboard/SessionRow.tsx
  </files>
  <action>
Create the authenticated app route group with a shared layout, the coach dashboard page, the athlete submissions page, the upload page, and the session row component.

**src/app/(app)/layout.tsx** — shared layout for authenticated app:
Reads `x-user-role` header (set by middleware) to render role-appropriate navigation. Coaches see: Dashboard, Upload, Roster, Sign out. Athletes see: My Submissions, Upload, Sign out.

```tsx
import { headers } from 'next/headers'
import { signOut } from '@/actions/auth'

export default async function AppLayout({ children }: { children: React.ReactNode }) {
  const headersList = await headers()
  const role = headersList.get('x-user-role') ?? 'coach'

  return (
    <div className="min-h-screen bg-gray-50">
      <nav className="bg-white border-b border-gray-200">
        <div className="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">
          <span className="font-bold text-gray-900">Softball Mechanics</span>
          <div className="flex items-center gap-6">
            {role === 'coach' ? (
              <>
                <a href="/dashboard" className="text-sm text-gray-600 hover:text-gray-900">Dashboard</a>
                <a href="/upload" className="text-sm text-gray-600 hover:text-gray-900">Upload</a>
                <a href="/roster" className="text-sm text-gray-600 hover:text-gray-900">Roster</a>
              </>
            ) : (
              <>
                <a href="/submissions" className="text-sm text-gray-600 hover:text-gray-900">My Submissions</a>
                <a href="/upload" className="text-sm text-gray-600 hover:text-gray-900">Upload</a>
              </>
            )}
            <form action={signOut}>
              <button type="submit" className="text-sm text-gray-500 hover:text-gray-700">Sign out</button>
            </form>
          </div>
        </div>
      </nav>
      <main className="max-w-6xl mx-auto px-4 py-8">
        {children}
      </main>
    </div>
  )
}
```

**src/components/dashboard/SessionRow.tsx** — single row in the coach session queue.
Shows: video thumbnail, athlete name + avatar, upload date/time, status badge (with polling via TranscodingStatus):

```tsx
'use client'

import { TranscodingStatus } from '@/components/upload/TranscodingStatus'
import Image from 'next/image'

interface SessionRowProps {
  videoId: string
  thumbnailUrl?: string | null
  athleteName: string
  uploadedAt: string
  status: string
}

export function SessionRow({ videoId, thumbnailUrl, athleteName, uploadedAt, status }: SessionRowProps) {
  return (
    <div className="flex items-center gap-4 bg-white rounded-lg border border-gray-200 p-4 hover:bg-gray-50 transition-colors">
      {/* Thumbnail */}
      <div className="w-20 h-14 rounded-md overflow-hidden bg-gray-100 flex-shrink-0">
        {thumbnailUrl ? (
          <Image
            src={thumbnailUrl}
            alt="Video thumbnail"
            width={80}
            height={56}
            className="w-full h-full object-cover"
          />
        ) : (
          <div className="w-full h-full flex items-center justify-center">
            <svg className="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5}
                d="M15 10l4.553-2.069A1 1 0 0121 8.82V15.18a1 1 0 01-1.447.894L15 14M3 8a2 2 0 012-2h8a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2V8z"
              />
            </svg>
          </div>
        )}
      </div>

      {/* Athlete info */}
      <div className="flex-1 min-w-0">
        <p className="text-sm font-medium text-gray-900 truncate">{athleteName}</p>
        <p className="text-xs text-gray-500 mt-0.5">
          {new Date(uploadedAt).toLocaleDateString('en-US', {
            month: 'short', day: 'numeric', year: 'numeric',
            hour: '2-digit', minute: '2-digit',
          })}
        </p>
      </div>

      {/* Status badge — polls if processing */}
      <TranscodingStatus videoId={videoId} />
    </div>
  )
}
```

**src/app/(app)/dashboard/page.tsx** — coach session queue (server component):
```tsx
import { createClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { SessionRow } from '@/components/dashboard/SessionRow'
import { InviteAthleteModal } from '@/components/roster/InviteAthleteModal'

export default async function DashboardPage() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) redirect('/login')

  // Role guard: athletes don't have a dashboard
  if (user.user_metadata?.role === 'athlete') redirect('/submissions')

  // Fetch all videos for coach's athletes, most recent first, with athlete name
  const { data: videos } = await supabase
    .from('videos')
    .select(`
      id,
      thumbnail_url,
      status,
      uploaded_at,
      profiles!athlete_id (full_name)
    `)
    .eq('coach_id', user.id)
    .order('uploaded_at', { ascending: false })

  const isEmpty = !videos || videos.length === 0

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-xl font-bold text-gray-900">Session Queue</h1>
        <InviteAthleteModal coachId={user.id} />
      </div>

      {isEmpty ? (
        <div className="text-center py-20 bg-white rounded-xl border border-dashed border-gray-300">
          <p className="text-gray-500 text-sm">No sessions yet.</p>
          <p className="text-gray-400 text-sm mt-1">Invite an athlete to get started.</p>
        </div>
      ) : (
        <div className="space-y-2">
          {videos.map((v) => (
            <SessionRow
              key={v.id}
              videoId={v.id}
              thumbnailUrl={v.thumbnail_url}
              athleteName={(v.profiles as any)?.full_name ?? 'Unknown athlete'}
              uploadedAt={v.uploaded_at}
              status={v.status}
            />
          ))}
        </div>
      )}
    </div>
  )
}
```

**src/app/(app)/submissions/page.tsx** — athlete submissions view (server component):
Athletes see their own videos only — uploaded by themselves or by the coach on their behalf.
```tsx
import { createClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { TranscodingStatus } from '@/components/upload/TranscodingStatus'

export default async function SubmissionsPage() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) redirect('/login')

  const { data: videos } = await supabase
    .from('videos')
    .select('id, title, status, uploaded_at, thumbnail_url, hls_url')
    .eq('athlete_id', user.id)
    .order('uploaded_at', { ascending: false })

  const isEmpty = !videos || videos.length === 0

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-xl font-bold text-gray-900">My Submissions</h1>
        <a
          href="/upload"
          className="bg-blue-600 text-white text-sm font-medium px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
        >
          Upload video
        </a>
      </div>

      {isEmpty ? (
        <div className="text-center py-20 bg-white rounded-xl border border-dashed border-gray-300">
          <p className="text-gray-500 text-sm">No submissions yet.</p>
          <p className="text-gray-400 text-sm mt-1">Upload a video to get feedback from your coach.</p>
        </div>
      ) : (
        <div className="space-y-3">
          {videos.map((v) => (
            <div key={v.id} className="bg-white rounded-lg border border-gray-200 p-4 flex items-center gap-4">
              <div className="w-20 h-14 rounded-md overflow-hidden bg-gray-100 flex-shrink-0">
                {v.thumbnail_url ? (
                  <img src={v.thumbnail_url} alt="thumbnail" className="w-full h-full object-cover" />
                ) : (
                  <div className="w-full h-full flex items-center justify-center text-gray-400 text-xs">No preview</div>
                )}
              </div>
              <div className="flex-1 min-w-0">
                <p className="text-sm font-medium text-gray-900 truncate">{v.title ?? 'Untitled'}</p>
                <p className="text-xs text-gray-500 mt-0.5">
                  {new Date(v.uploaded_at).toLocaleDateString('en-US', {
                    month: 'short', day: 'numeric', year: 'numeric',
                  })}
                </p>
              </div>
              <TranscodingStatus videoId={v.id} />
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
```

**src/app/(app)/upload/page.tsx** — upload page with athlete assignment dropdown.
Coach must select which athlete the video is for before uploading. Athlete uploading their own video has athleteId pre-filled from their session:
```tsx
import { createClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { UploadPageClient } from '@/components/upload/UploadPageClient'

export default async function UploadPage() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/login')

  const role = user.user_metadata?.role ?? 'coach'

  // For coaches: fetch their athlete roster for the dropdown
  let athletes: { id: string; full_name: string }[] = []
  if (role === 'coach') {
    const { data } = await supabase
      .from('coach_athletes')
      .select('athlete_id, profiles!athlete_id(id, full_name)')
      .eq('coach_id', user.id)
      .eq('status', 'active')

    athletes = (data ?? [])
      .map(r => (r.profiles as any))
      .filter(Boolean)
  }

  return (
    <UploadPageClient
      coachId={role === 'coach' ? user.id : undefined}
      athleteId={role === 'athlete' ? user.id : undefined}
      athletes={athletes}
    />
  )
}
```

Create `src/components/upload/UploadPageClient.tsx` as a thin client wrapper that renders the athlete selector (if coach) and VideoUploader:

```tsx
'use client'

import { useState } from 'react'
import { VideoUploader } from '@/components/upload/VideoUploader'

interface UploadPageClientProps {
  coachId?: string
  athleteId?: string
  athletes: { id: string; full_name: string }[]
}

export function UploadPageClient({ coachId, athleteId, athletes }: UploadPageClientProps) {
  const [selectedAthleteId, setSelectedAthleteId] = useState(athleteId ?? '')

  const isCoach = !!coachId
  const effectiveAthleteId = isCoach ? selectedAthleteId : athleteId!
  const effectiveCoachId = coachId ?? ''  // Athletes don't have coachId readily; TODO Phase 5

  const canUpload = !!effectiveAthleteId

  return (
    <div>
      <h1 className="text-xl font-bold text-gray-900 mb-6">Upload Video</h1>

      {isCoach && (
        <div className="mb-6">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Upload for athlete
          </label>
          {athletes.length === 0 ? (
            <p className="text-sm text-gray-500">
              No active athletes yet.{' '}
              <a href="/roster" className="text-blue-600 hover:underline">Invite one from the roster.</a>
            </p>
          ) : (
            <select
              value={selectedAthleteId}
              onChange={(e) => setSelectedAthleteId(e.target.value)}
              className="w-full max-w-xs rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Select athlete…</option>
              {athletes.map(a => (
                <option key={a.id} value={a.id}>{a.full_name}</option>
              ))}
            </select>
          )}
        </div>
      )}

      {canUpload ? (
        <VideoUploader
          athleteId={effectiveAthleteId}
          coachId={effectiveCoachId}
        />
      ) : (
        <p className="text-sm text-gray-500">Please select an athlete above to upload a video.</p>
      )}
    </div>
  )
}
```

Add `src/components/upload/UploadPageClient.tsx` to files_modified.
  </action>
  <verify>
    <automated>cd /Users/abhishekhodavdekar/git/softball-mechanics && npx tsc --noEmit 2>&1 | head -30</automated>
  </verify>
  <done>
    `npx tsc --noEmit` exits 0. Dashboard page queries `videos` with `coach_id = user.id`. Submissions page queries `videos` with `athlete_id = user.id`. App layout reads `x-user-role` header. SessionRow uses `TranscodingStatus` component. Upload page requires athlete selection before enabling VideoUploader. Role-based redirect is present in both dashboard and submissions pages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Roster management — RosterList and InviteAthleteModal</name>
  <files>
    src/components/roster/RosterList.tsx
    src/components/roster/InviteAthleteModal.tsx
    src/app/(app)/roster/page.tsx
  </files>
  <action>
Create the roster page, the RosterList component, and the InviteAthleteModal.

**src/components/roster/RosterList.tsx** — displays coach's athlete roster:
```tsx
interface Athlete {
  id: string
  email: string
  name?: string
  status: 'pending' | 'active'
  videoCount: number
  invitedAt: string
}

interface RosterListProps {
  athletes: Athlete[]
}

export function RosterList({ athletes }: RosterListProps) {
  if (athletes.length === 0) {
    return (
      <div className="text-center py-12 bg-white rounded-xl border border-dashed border-gray-300">
        <p className="text-gray-500 text-sm">No athletes yet.</p>
        <p className="text-gray-400 text-sm mt-1">Use the invite button to add your first athlete.</p>
      </div>
    )
  }

  return (
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <table className="w-full text-sm">
        <thead className="bg-gray-50 border-b border-gray-200">
          <tr>
            <th className="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider">Athlete</th>
            <th className="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th className="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider">Videos</th>
            <th className="text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider">Invited</th>
          </tr>
        </thead>
        <tbody className="divide-y divide-gray-100">
          {athletes.map(a => (
            <tr key={a.id} className="hover:bg-gray-50">
              <td className="px-4 py-3">
                <div>
                  <p className="font-medium text-gray-900">{a.name ?? a.email}</p>
                  {a.name && <p className="text-xs text-gray-500">{a.email}</p>}
                </div>
              </td>
              <td className="px-4 py-3">
                <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${
                  a.status === 'active'
                    ? 'bg-green-100 text-green-800'
                    : 'bg-gray-100 text-gray-600'
                }`}>
                  {a.status === 'active' ? 'Active' : 'Invite sent'}
                </span>
              </td>
              <td className="px-4 py-3 text-gray-600">{a.videoCount}</td>
              <td className="px-4 py-3 text-gray-500 text-xs">
                {new Date(a.invitedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )
}

export type { Athlete }
```

**src/components/roster/InviteAthleteModal.tsx** — modal for inviting a new athlete by email:
```tsx
'use client'

import { useState } from 'react'
import { inviteAthlete } from '@/actions/auth'

interface InviteAthleteModalProps {
  coachId: string
}

export function InviteAthleteModal({ coachId }: InviteAthleteModalProps) {
  const [open, setOpen] = useState(false)
  const [email, setEmail] = useState('')
  const [status, setStatus] = useState<'idle' | 'loading' | 'sent' | 'error'>('idle')
  const [errorMessage, setErrorMessage] = useState<string | null>(null)

  async function handleInvite(e: React.FormEvent) {
    e.preventDefault()
    setStatus('loading')
    setErrorMessage(null)

    try {
      await inviteAthlete(email, coachId)
      setStatus('sent')
      setEmail('')
    } catch (err) {
      setStatus('error')
      setErrorMessage(err instanceof Error ? err.message : 'Invite failed')
    }
  }

  function handleClose() {
    setOpen(false)
    setStatus('idle')
    setEmail('')
    setErrorMessage(null)
  }

  return (
    <>
      <button
        onClick={() => setOpen(true)}
        className="bg-blue-600 text-white text-sm font-medium px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
      >
        Invite athlete
      </button>

      {open && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl w-full max-w-md p-6 shadow-xl">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-semibold text-gray-900">Invite athlete</h2>
              <button onClick={handleClose} className="text-gray-400 hover:text-gray-600">
                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            {status === 'sent' ? (
              <div className="text-center py-4">
                <p className="text-green-600 font-medium">Invite sent!</p>
                <p className="text-gray-500 text-sm mt-1">
                  Your athlete will receive an email with a link to access the app.
                </p>
                <button
                  onClick={handleClose}
                  className="mt-4 text-sm text-blue-600 hover:underline"
                >
                  Done
                </button>
              </div>
            ) : (
              <form onSubmit={handleInvite} className="space-y-4">
                <div>
                  <label htmlFor="athleteEmail" className="block text-sm font-medium text-gray-700 mb-1">
                    Athlete email
                  </label>
                  <input
                    id="athleteEmail"
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    required
                    placeholder="athlete@example.com"
                    className="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <p className="text-xs text-gray-500">
                  They'll receive a magic link to access their submissions — no password needed.
                </p>
                {errorMessage && (
                  <p className="text-red-600 text-sm">{errorMessage}</p>
                )}
                <div className="flex gap-3 justify-end">
                  <button
                    type="button"
                    onClick={handleClose}
                    className="text-sm text-gray-600 hover:text-gray-900 px-4 py-2"
                  >
                    Cancel
                  </button>
                  <button
                    type="submit"
                    disabled={status === 'loading'}
                    className="bg-blue-600 text-white text-sm font-medium px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors"
                  >
                    {status === 'loading' ? 'Sending…' : 'Send invite'}
                  </button>
                </div>
              </form>
            )}
          </div>
        </div>
      )}
    </>
  )
}
```

**src/app/(app)/roster/page.tsx** — coach roster page (server component):
```tsx
import { createClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { RosterList, type Athlete } from '@/components/roster/RosterList'
import { InviteAthleteModal } from '@/components/roster/InviteAthleteModal'

export default async function RosterPage() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) redirect('/login')
  if (user.user_metadata?.role === 'athlete') redirect('/submissions')

  // Fetch coach's athlete roster with video counts
  const { data: rosterData } = await supabase
    .from('coach_athletes')
    .select(`
      id,
      athlete_email,
      status,
      invited_at,
      athlete_id,
      profiles!athlete_id (full_name)
    `)
    .eq('coach_id', user.id)
    .order('invited_at', { ascending: false })

  // Get video count per athlete
  const athleteIds = (rosterData ?? [])
    .filter(r => r.athlete_id)
    .map(r => r.athlete_id!)

  let videoCounts: Record<string, number> = {}
  if (athleteIds.length > 0) {
    const { data: countData } = await supabase
      .from('videos')
      .select('athlete_id')
      .in('athlete_id', athleteIds)
      .eq('coach_id', user.id)

    videoCounts = (countData ?? []).reduce((acc, v) => {
      acc[v.athlete_id] = (acc[v.athlete_id] ?? 0) + 1
      return acc
    }, {} as Record<string, number>)
  }

  const athletes: Athlete[] = (rosterData ?? []).map(r => ({
    id: r.id,
    email: r.athlete_email,
    name: (r.profiles as any)?.full_name,
    status: r.status as 'pending' | 'active',
    videoCount: r.athlete_id ? (videoCounts[r.athlete_id] ?? 0) : 0,
    invitedAt: r.invited_at,
  }))

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-xl font-bold text-gray-900">Roster</h1>
        <InviteAthleteModal coachId={user.id} />
      </div>
      <RosterList athletes={athletes} />
    </div>
  )
}
```
  </action>
  <verify>
    <automated>cd /Users/abhishekhodavdekar/git/softball-mechanics && npm run build 2>&1 | tail -15</automated>
  </verify>
  <done>
    `npm run build` exits 0. All pages and components exist. RosterList renders a table of athletes with status badges and video counts. InviteAthleteModal calls `inviteAthlete` server action and shows success state after invite sent. Roster page is coach-only (redirects athletes). `npm run build` is used here instead of `tsc --noEmit` because this is the final auto task — confirms the full project compiles for deployment.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: End-to-end Phase 1 verification</name>
  <action>Verify the complete Phase 1 user journey end-to-end: coach signup → athlete invite → invite acceptance → video upload → transcoding → dashboard display. Run `npm run dev` and follow the verification steps below.</action>
  <what-built>
    Complete Phase 1 foundation:
    - Coach signup and login (Supabase email/password)
    - Athlete invite via email (Supabase admin inviteUserByEmail — magic link)
    - Role-scoped views: coach sees /dashboard, athlete sees /submissions
    - Video upload: desktop drag-and-drop + mobile camera roll selection (multi-file)
    - R2 presigned PUT upload with progress bars
    - Inngest transcodeVideo function (5-step: download → FFmpeg 720p HLS → upload HLS → thumbnail → DB update)
    - Coach session queue with status badges (Processing / Ready / Reviewed / Delivered)
    - Athlete submissions view
    - Roster management: invite modal + roster table with athlete status and video count
    - HLS playback via hls.js
  </what-built>
  <how-to-verify>
    **Pre-flight:** Make sure `.env.local` has all values filled in from `.env.local.example`.

    Run: `npm run dev`

    **Flow 1 — Coach account:**
    1. Visit http://localhost:3000/signup
    2. Create a coach account with your email
    3. Confirm: redirected to /dashboard with empty state ("No sessions yet. Invite an athlete to get started.")
    4. Visit /roster — confirm empty state shown
    5. Click "Invite athlete" — enter a different email you control
    6. Confirm: success message shown, "Invite sent!"

    **Flow 2 — Athlete invite acceptance:**
    7. Check the invited email inbox
    8. Click the invite link
    9. Confirm: lands on /invite/[token] page, shows "Accepting your invite…" then "Invite accepted! Redirecting…"
    10. Confirm: athlete is redirected to /submissions with empty state

    **Flow 3 — Video upload:**
    11. Log back in as coach
    12. Visit /upload
    13. Confirm: athlete dropdown shows the invited athlete (after they accepted invite)
    14. Select the athlete, then drag-and-drop or select a short video file
    15. Confirm: progress bar appears, status changes to "Uploading"
    16. Confirm: after upload, status changes to "Processing" (Inngest is running)
    17. Wait ~2 minutes
    18. Confirm: status changes to "Ready" on /dashboard

    **Flow 4 — HLS playback (if time permits):**
    19. Confirm video row on /dashboard shows thumbnail after transcoding
    20. The HLSPlayer will be hooked up to the dashboard in a later phase — for now, verify the `hls_url` is present in the video row by checking Supabase dashboard

    **Role separation:**
    21. While logged in as athlete, try visiting /dashboard
    22. Confirm: redirected to /submissions

    **Mobile upload (if on mobile or DevTools mobile simulation):**
    23. Visit /upload on mobile — confirm: "Select videos to upload" button is shown (not drag-and-drop)
    24. Tap the button — confirm: opens camera roll (not camera)
  </how-to-verify>
  <resume-signal>
    Type "approved" if the full flow works, or describe any issues found so gaps can be diagnosed and closed.
  </resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` exits 0
2. Coach dashboard queries `videos` with `coach_id = user.id` and orders by `uploaded_at desc`
3. Athlete submissions page queries `videos` with `athlete_id = user.id`
4. Roster page shows athletes with status (`pending`/`active`) and video count
5. InviteAthleteModal calls `inviteAthlete` server action (not direct Supabase client call)
6. App layout reads `x-user-role` from headers (set by middleware)
</verification>

<success_criteria>
- Phase 1 goal fully met: coaches and athletes can access the app with proper role separation, upload videos that transcode and stream reliably via HLS, and coaches can manage their athlete roster
- All 8 Phase 1 requirements satisfied: AUTH-01 through AUTH-04, VID-01, VID-02, ROST-01, ROST-02
- Human verification checkpoint passes with no blockers
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-05-SUMMARY.md` with:
- Files created
- Results of the human verification checkpoint
- Any issues found during verification and how they were resolved
- Confirmation of which Phase 1 success criteria from ROADMAP.md are met
- Notes on anything deferred to gap closure plans (if any)
</output>
